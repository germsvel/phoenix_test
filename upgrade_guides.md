Upgrade Guides
==============

## Upgrading to 0.5.3

Version 0.5.3 deprecates `select/3` and `select/4` using `:from` to denote the
label. Instead, it expects the label text to be passed as a positional argument
and an `:option` keyword argument to pass the option's text.

Thus, you'll need to make this change:

```diff
- |> select("Option 1", from: "Select Label")
+ |> select("Select Label", option: "Option 1")
```

And if you're using the version that provides a CSS selector:

```diff
- |> select("#super-select", "Option 1", from: "Select Label")
+ |> select("#super-select", "Select Label", option: "Option 1")
```

### Why the change?

It may seem like a silly change (basically swapping positions of label and
option arguments), and in some ways it is. There's no real change in
functionality. So I've been very hesitant to make this change for a while.

The problem is that `select` is a bit surprising and confusing to use!

All other form helpers take in the label first as a positional argument, and
then any additional arguments (when they have them) go into a keyword list.

But `select` breaks that convention. It causes people to have to do mental
gymnastics to switch the order of arguments.

Rather than live with confusion for the rest of our lives, it seems better to
incur the cost right now, and then we can move on with all of our form helpers
being consistent.

## Upgrading to 0.2.13

Version 0.2.13 deprecates `fill_form/3` and `submit_form/3`.

ðŸ¥º I know it's a pain. I'm sorry about that.

I don't take changing APIs lightly (even pre 1.0)... but I think you'll like
these changes.

### New form helpers

Let me introduce you to our new form helpers:

- `fill_in/3`
- `select/3`
- `choose/3`
- `check/3`
- `uncheck/3`

These new form helpers target elements by labels! ðŸ¥³

Instead of relying on the underlying data structures generated by Phoenix
forms and changesets, you can now specify which label you're targeting.

Change this: ðŸ‘‡

```elixir
session
|> fill_form("form", user: %{
  name: "Aragorn",
  admin: true,
  country: "Arnor"
})
```

To this: ðŸ‘‡

```elixir
session
|> fill_in("Name", with: "Aragorn")
|> check("Admin")
|> select("Arnor", from: "Countries")
```

The new format:

- encourages us (me included!) to use labels in forms,
- decouples the testing of our forms from the underlying shape of a changeset or
  Phoenix form -- something that's a mere implementation detail, and
- allows us to express our tests closer to the language a user would use when
  seeing a page.

**But what if I don't want the label to show?**

It's a good idea to have labels for accessibility -- even if they're not visible
on the page. In those cases, you should hide them with CSS.

For example, if you use Tailwind, you can add a `sr-only` class to your label.
That will mark it as "screen-reader only" and hide it.

### Targeting a form to fill out

Since `fill_form/3` used to allow targeting a form by CSS selector, you may want
to target a form via CSS selector with the new format. To do that, you can scope
all of the form helpers using `within/3`:

```elixir
session
|> within("#user-form", fn session ->
  session
  |> fill_in("Name", with: "Aragorn")
  |> check("Admin")
  |> select("Arnor", from: "Countries")
end)
```

NOTE: you may no longer _need_ to target your form via CSS selector. The new
helpers are a lot smarter since they're looking for the labels and their
associated inputs or options.

But if you have multiple forms with the same labels (even when those labels
point to different inputs), then you might have to scope your form-filling. And
that's where `within/3` can be handy.

### Submitting forms without clicking a button

Once we've filled out a form, we typically click a button with `click_button/2`
to submit the form. But sometimes you want to emulate what would happen by just
pressing <Enter> (or do what `submit_form/3` used to do).

For that case, you can use `submit/1` to submit the form you just filled out.

```elixir
session
|> fill_in("Name", with: "Aragorn")
|> check("Admin")
|> select("Arnor", from: "Countries")
|> submit()
```
